 # Исходный код для пайплайна
### Суммарное описание скриптов

**1. Скрипт `data_preprocessing.py`:**

Этот скрипт предназначен для предварительной обработки данных. Он выполняет следующие задачи:
- Загружает и обрабатывает изображения, изменяя их размер до заданного формата.
- Загружает и обрабатывает данные из файла формата Parquet.
- Удаляет строки с отсутствующими заголовками и описаниями.
- Преобразует идентификаторы изображений в пути к файлам изображений.
- Сохраняет обработанные данные в формате CSV.

**Пример использования:**
```bash
python data_preprocessing.py --file_path <path_to_parquet_file> --base_image_path <path_to_images> --processed_data_path <path_to_save_processed_data> --processed_images_path <path_to_save_resized_images> --default_image_size 384 384
```

**2. Скрипт `train_model.py`:**

Этот скрипт предназначен для обучения модели ruCLIP на предварительно обработанных данных. Он выполняет следующие задачи:
- Загружает модель ruCLIP и необходимые компоненты.
- Загружает обработанные данные из CSV-файла, созданного в `data_preprocessing.py`.
- Создает DataLoader для обучения модели.
- Настраивает оптимизатор и планировщик обучения.
- Обучает модель на основе данных, отслеживая прогресс с помощью tqdm и wandb.
- Сохраняет обученную модель после каждой эпохи.

**Пример использования:**
```bash
python train_model.py --file_path <path_to_parquet_file> --base_image_path <path_to_images> --processed_data_path <path_to_processed_csv> --model_save_path <path_to_save_model> --project_name fine-tuning-ruclip --num_epochs 2 --batch_size 32 --lr 1e-6
```

**3. Скрипт `generate_embeddings.py`:**

Этот скрипт предназначен для генерации эмбеддингов текста и изображений, используя предварительно обученную модель ruCLIP или её дообученную версию. Он выполняет следующие задачи:

- Загружает базовую модель ruCLIP или использует указанную дообученную модель.
- Инициализирует предсказатель ruCLIP для генерации эмбеддингов.
- Загружает данные из CSV-файла, который должен содержать колонки 'title' и 'image_path'.
- Последовательно обрабатывает данные, генерируя эмбеддинги для текстов и изображений.
- Сохраняет полученные эмбеддинги в файл формата NPZ.

### Классы и Методы

- **`EmbeddingPipeline`**:
  - **Инициализация**:
    - Загружает модель ruCLIP, настраивает устройство для вычислений (CPU или GPU).
    - Если указан путь к дообученной модели, загружает её веса.
  - **`TextDataset`**: Подкласс для создания датасета из текстов и путей к изображениям.
  - **`get_embeddings`**: Обрабатывает данные пакетами, извлекая эмбеддинги для текста и соответствующих изображений.

- **`generate_embeddings`**:
  - Генерирует эмбеддинги, используя экземпляр `EmbeddingPipeline`.
  - Сохраняет эмбеддинги в указанный файл.

### Пример использования:

```bash
python generate_embeddings.py \
    --fine_tuned_model_path <path_to_fine_tuned_model> \
    --processed_data_csv <path_to_processed_data_csv> \
    --output_path <path_to_save_embeddings> \
    --batch_size 32
```





